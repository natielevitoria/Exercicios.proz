<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Jogo da Mem√≥ria</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#000">
  <link rel="icon" href="favicon.png" type="image/png">
  <style>
    body {
      margin: 0; font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg,#e0f7fa,#fce4ec);
      display: flex; justify-content: center; align-items: center;
      min-height: 100vh; padding: 20px; box-sizing: border-box;
    }
    .screen {
      display: none; flex-direction: column; align-items: center; justify-content: center;
      text-align: center; padding: 30px; border-radius: 20px; background: #fff;
      box-shadow: 0 10px 25px rgba(0,0,0,.2); max-width: 600px; width: 100%;
      animation: fadeIn .8s ease-in-out;
    }
    .screen.active {display: flex;}
    h1 {font-size: 2.5em; margin-bottom: 20px; color: #4a148c;}
    p {font-size: 1.1em; color: #555; margin-bottom: 25px;}
    select {
      padding: 10px; font-size: 1em; margin-bottom: 20px;
      border-radius: 10px; border: 1px solid #ccc;
    }
    .start-btn,.restart-btn {
      padding: 12px 25px; font-size: 1em; background: #7b1fa2;
      color: #fff; border: none; border-radius: 12px; cursor: pointer;
      transition: background .3s; margin-top: 20px;
    }
    .start-btn:hover,.restart-btn:hover {background: #6a1b9a;}
    .stats {font-size: 1.1em; margin-bottom: 20px; color: #555;}
    .stats span {margin: 0 10px;}
    .card-board {
      display: grid; grid-template-columns: repeat(auto-fit,minmax(80px,1fr));
      gap: 15px; width: 100%;
    }
    .card {aspect-ratio: 1/1; width: 100%; perspective: 1000px; cursor: pointer;}
    .card-inner {width: 100%; height: 100%; transition: transform .6s; transform-style: preserve-3d;}
    .card.flipped .card-inner {transform: rotateY(180deg);}
    .card-front,.card-back {
      position: absolute; width: 100%; height: 100%; backface-visibility: hidden;
      border-radius: 12px; display: flex; justify-content: center; align-items: center; font-size: 2em;
    }
    .card-front {background: #ce93d8; color: #fff;}
    .card-back {background: #4a148c; color: #fff; transform: rotateY(180deg);}
    .card.matched {animation: pulse 0.4s ease-in-out;}
    @keyframes pulse {
      0% {transform: scale(1);}
      50% {transform: scale(1.1);}
      100% {transform: scale(1);}
    }
    .win-message {font-size: 1.2em; color: #2e7d32; margin-top: 15px; animation: fadeIn 1s ease-in-out;}
    @keyframes fadeIn {from{opacity:0;transform:scale(.9);} to{opacity:1;transform:scale(1);}}
  </style>
</head>
<body>
  <div class="screen active" id="start-screen">
    <h1>üéÆ Bem-vindo ao Jogo da Mem√≥ria!</h1>
    <p>Escolha um tema, dificuldade e tempo:</p>
    <select id="theme-select">
      <option value="frutas">üçé Frutas</option>
      <option value="animais">üê∂ Animais</option>
      <option value="emojis">üòÑ Emojis</option>
    </select>
    <select id="difficulty-select">
      <option value="facil">F√°cil</option>
      <option value="medio">M√©dio</option>
      <option value="dificil">Dif√≠cil</option>
    </select>
    <select id="time-select">
      <option value="30">30 segundos</option>
      <option value="60" selected>60 segundos</option>
      <option value="90">90 segundos</option>
    </select>
    <button class="start-btn" id="start-btn">Iniciar Jogo</button>
  </div>

  <div class="screen" id="game-screen">
    <h1>Jogo da Mem√≥ria</h1>
    <div class="stats">
      <span>üïπÔ∏è Movimentos: <strong id="moves">0</strong></span>
      <span>‚è±Ô∏è Tempo restante: <strong id="timer">60s</strong></span>
    </div>
    <div class="card-board" id="card-board"></div>
    <button class="restart-btn" id="restart-btn">üîÑ Reiniciar Jogo</button>
    <button class="restart-btn" id="back-btn">‚¨ÖÔ∏è Voltar</button>
    <div id="win-message" class="win-message"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <script>
    const themes = {
      frutas: ['üçé','üçå','üçí','üçç','üçâ','üçá','ü•≠','üçë','üçê','üçä'],
      animais: ['üê∂','üê±','üê≠','üê∞','ü¶ä','üêª','üêº','üê∑','üê∏','üê®'],
      emojis: ['üòÄ','üòé','ü•≥','üò°','üò≠','üòç','ü§ñ','üëΩ','üò¥','üò±']
    };
    const difficulties = {facil:6, medio:8, dificil:10};

    let selectedTheme='frutas',cardsArray=[],flippedCards=[],matchedCards=[],moves=0,timer=60,interval,lockBoard=false;
    const startScreen=document.getElementById('start-screen'),
          gameScreen=document.getElementById('game-screen'),
          startBtn=document.getElementById('start-btn'),
          cardBoard=document.getElementById('card-board'),
          restartBtn=document.getElementById('restart-btn'),
          backBtn=document.getElementById('back-btn'),
          movesDisplay=document.getElementById('moves'),
          timerDisplay=document.getElementById('timer'),
          winMessage=document.getElementById('win-message');

    startBtn.onclick=()=>{
      selectedTheme=document.getElementById('theme-select').value;
      const difficulty=document.getElementById('difficulty-select').value;
      const timeLimit=parseInt(document.getElementById('time-select').value);
      const count=difficulties[difficulty];
      cardsArray=[...themes[selectedTheme]].slice(0,count);
      cardsArray=[...cardsArray,...cardsArray];
      timer=timeLimit;
      startScreen.classList.remove('active');
      gameScreen.classList.add('active');
      restartGame();
    };

    const shuffleArray=a=>{
      for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}
      return a;
    };

    function createBoard(){
      const shuffled=shuffleArray([...cardsArray]);
      cardBoard.innerHTML='';
      shuffled.forEach(c=>{
        const el=document.createElement('div');
        el.classList.add('card');
        el.dataset.value=c;
        el.innerHTML=`<div class="card-inner"><div class="card-front">‚ùì</div><div class="card-back">${c}</div></div>`;
        el.addEventListener('click',flipCard);
        cardBoard.appendChild(el);
      });
    }

    function flipCard(e){
      if(lockBoard)return;
      const card=e.currentTarget;
      if(card.classList.contains('flipped')||card.classList.contains('matched'))return;
      card.classList.add('flipped');
      flippedCards.push(card);
      if(flippedCards.length===2){
                lockBoard=true;
        moves++;
        movesDisplay.textContent=moves;
        setTimeout(checkMatch,700);
      }
    }

    function checkMatch(){
      const [c1,c2]=flippedCards;
      if(c1.dataset.value===c2.dataset.value){
        c1.classList.add('matched');
        c2.classList.add('matched');
        matchedCards.push(c1,c2);
      } else {
        c1.classList.remove('flipped');
        c2.classList.remove('flipped');
      }
      flippedCards=[];
      lockBoard=false;

      if(matchedCards.length===cardsArray.length){
        clearInterval(interval);
        winMessage.innerHTML=`üéâ Voc√™ venceu em ${moves} movimentos e ${timer} segundos!<br>`;
        
        // Recorde de movimentos
        const bestMoves = localStorage.getItem('bestMoves');
        if (!bestMoves || moves < bestMoves) {
          localStorage.setItem('bestMoves', moves);
          winMessage.innerHTML += `üèÜ Novo recorde de movimentos!`;
        } else {
          winMessage.innerHTML += `üèÜ Recorde atual: ${bestMoves} movimentos`;
        }

        confetti({particleCount:150,spread:70,origin:{y:0.6}});
      }
    }

    function restartGame(){
      matchedCards=[];
      flippedCards=[];
      moves=0;
      lockBoard=false;
      movesDisplay.textContent='0';
      winMessage.textContent='';
      createBoard();

      // Inicia contador regressivo
      timerDisplay.textContent=`${timer}s`;
      clearInterval(interval);
      interval=setInterval(()=>{
        timer--;
        timerDisplay.textContent=`${timer}s`;
        if(timer<=0){
          clearInterval(interval);
          lockBoard=true;
          winMessage.textContent='‚è∞ Tempo esgotado! Tente novamente.';
        }
      },1000);
    }

    backBtn.onclick=()=>{
      clearInterval(interval);
      gameScreen.classList.remove('active');
      startScreen.classList.add('active');
    };

    restartBtn.onclick=restartGame;

    if('serviceWorker' in navigator)
      navigator.serviceWorker.register('service-worker.js')
        .then(()=>console.log('Service Worker registrado'))
        .catch(err=>console.log('Erro no SW:',err));
  </script>
</body>
</html>